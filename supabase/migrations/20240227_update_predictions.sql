-- Drop existing table if it exists
drop table if exists predictions;

-- Create new predictions table with updated schema
create table predictions (
    id bigint generated by default as identity primary key,
    created_at timestamp with time zone default timezone('utc'::text, now()) not null,
    game_id text not null unique,
    game_date text not null,
    home_team text not null,
    away_team text not null,
    predicted_home_score integer not null,
    predicted_away_score integer not null,
    predicted_total integer not null,
    fanduel_spread_home numeric not null,
    fanduel_total numeric not null,
    home_moneyline integer,
    away_moneyline integer,
    actual_home_score integer,
    actual_away_score integer,
    spread_result text check (spread_result in ('win', 'loss', 'push')),
    total_result text check (total_result in ('win', 'loss', 'push')),
    game_status text,
    prediction_accuracy numeric
);

-- Create indexes for better query performance
create index if not exists predictions_game_id_idx on predictions(game_id);
create index if not exists predictions_game_date_idx on predictions(game_date);
create index if not exists predictions_spread_result_idx on predictions(spread_result) where spread_result is not null;
create index if not exists predictions_total_result_idx on predictions(total_result) where total_result is not null;